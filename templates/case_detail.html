{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h3>Case {{ case.case_number }}</h3>
  <div class="d-flex gap-2">
    <form method="post" action="{{ url_for('case_status', case_number=case.case_number) }}" class="d-flex gap-2">
      <select name="status" class="form-select">
        <option value="created" {% if case.status=='created' %}selected{% endif %}>Created</option>
        <option value="received" {% if case.status=='received' %}selected{% endif %}>Received</option>
        <option value="in_lab" {% if case.status=='in_lab' %}selected{% endif %}>In Lab</option>
        <option value="completed" {% if case.status=='completed' %}selected{% endif %}>Completed</option>
      </select>
      <button class="btn btn-secondary">Update</button>
    </form>
    <a class="btn btn-outline-success" href="{{ url_for('case_report', case_number=case.case_number) }}">Download Report</a>
  </div>
</div>
<p class="text-muted">Offence: {{ case.offence_type }} • Priority: <strong>{{ case.priority_score }}</strong> • Status: {{ case.status }}</p>

<h5 class="mt-4">Samples</h5>
<div class="row g-3">
  {% for s in samples %}
  <div class="col-md-3">
    <div class="card p-2">
      <div><strong>{{ s.code }}</strong></div>
      {% if s.qr_path %}
      <img src="{{ url_for('static', filename=s.qr_path) }}" class="img-fluid" alt="QR">
      {% endif %}
      <div>Status: {{ s.status }}</div>
    </div>
  </div>
  {% endfor %}
</div>

<h5 class="mt-4">Chain of Custody</h5>
<ul class="list-group">
  {% for ev in events %}
    <li class="list-group-item">{{ ev.timestamp }} — {{ ev.actor }} — {{ ev.action }} {% if ev.note %} ({{ ev.note }}){% endif %}</li>
  {% endfor %}
</ul>
{% endblock %}
